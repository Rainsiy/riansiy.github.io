[{"id":"6b543f1527434665d606727136a7f56f","title":"SSPanel-Metron搭配XrayR后端配置SS协议节点","content":"正在摸\n","slug":"SSPanel-Metron搭配XrayR后端配置SS协议节点","date":"2022-07-17T06:46:51.000Z","categories_index":"SSPanel","tags_index":"Metron,XrayR","author_index":"Riansy"},{"id":"210f816b607327db99c7b657589ac439","title":"SSPanel-Metron前端搭建教程","content":"正在摸\n","slug":"SSPanel-Metron前端搭建教程","date":"2022-07-17T06:46:46.000Z","categories_index":"SSPanel","tags_index":"Metron","author_index":"Riansy"},{"id":"e121e1d4dc52e3ebdd9b65d941d97aa7","title":"在Linux系统上开启BBR加速","content":"前言Google BBR是一款Google开发的拥堵控制算法，通过优化和控制TCP的拥塞，充分利用带宽并降低延迟，使得服务器的带宽得到合理化应用。\n\n\n\n\n\n\n\n\n\n本篇文章我们将在CentOS7和Debian11上演示开启Google BBR的具体步骤。\n\n\n在CentOS7上开启Google BBR一、升级系统内核1.首先查看内核版本，确定自己是否需要更新内核(可略过)，版本如果大于4.9就可以不用升级，但建议升级。\n$ uname -a\n\n终端执行演示\n[root@centos ~]# uname -a\nLinux centos 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\n\n\n2.使用这个命令您可以查看系统安装的所有内核\n$ rpm -qa | grep kernel\n\n终端执行演示\n[root@centos ~]# rpm -qa | grep kernel\nkernel-devel-3.10.0-1160.el7.x86_64\nkernel-tools-libs-3.10.0-1160.el7.x86_64\nabrt-addon-kerneloops-2.1.11-60.el7.centos.x86_64\nkernel-headers-3.10.0-1160.el7.x86_64\nkernel-3.10.0-1160.el7.x86_64\nkernel-tools-3.10.0-1160.el7.x86_64\n\n\n3.启用elrepo仓库\n$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org #导入公共密钥\n$ rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm #安装elrepo仓库的yum源\n\n终端执行演示\n[root@centos ~]# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org #导入公共密钥\n[root@centos ~]# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm #安装elrepo仓库的yum源\nRetrieving http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\nRetrieving http://elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm\nPreparing...                          ################################# [100%]\nUpdating / installing...\n   1:elrepo-release-7.0-4.el7.elrepo  ################################# [100%]\n\n\n4.安装最新版本的内核\n$ yum --enablerepo=elrepo-kernel install kernel-ml -y\n\n终端执行演示\n[root@centos ~]# yum --enablerepo=elrepo-kernel install kernel-ml -y\nLoaded plugins: fastestmirror, langpacks\nLoading mirror speeds from cached hostfile\n * base: mirrors.ustc.edu.cn\n * elrepo: hkg.mirror.rackspace.com\n * elrepo-kernel: hkg.mirror.rackspace.com\n * extras: mirrors.ustc.edu.cn\n * updates: mirrors.ustc.edu.cn\nbase                                                                                                                                                                                                            | 3.6 kB  00:00:00     \nelrepo                                                                                                                                                                                                          | 3.0 kB  00:00:00     \nelrepo-kernel                                                                                                                                                                                                   | 3.0 kB  00:00:00     \nextras                                                                                                                                                                                                          | 2.9 kB  00:00:00     \nupdates                                                                                                                                                                                                         | 2.9 kB  00:00:00     \n(1/2): elrepo/primary_db                                                                                                                                                                                        | 390 kB  00:00:00     \n(2/2): elrepo-kernel/primary_db                                                                                                                                                                                 | 2.1 MB  00:00:00     \nResolving Dependencies\n--> Running transaction check\n---> Package kernel-ml.x86_64 0:5.18.12-1.el7.elrepo will be installed\n--> Finished Dependency Resolution\n\nDependencies Resolved\n\n=======================================================================================================================================================================================================================================\n Package                                              Arch                                              Version                                                         Repository                                                Size\n=======================================================================================================================================================================================================================================\nInstalling:\n kernel-ml                                            x86_64                                            5.18.12-1.el7.elrepo                                            elrepo-kernel                                             56 M\n\nTransaction Summary\n=======================================================================================================================================================================================================================================\nInstall  1 Package\n\nTotal download size: 56 M\nInstalled size: 257 M\nDownloading packages:\nkernel-ml-5.18.12-1.el7.elrepo.x86_64.rpm                                                                                                                                                                       |  56 MB  00:00:01     \nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\nWarning: RPMDB altered outside of yum.\n  Installing : kernel-ml-5.18.12-1.el7.elrepo.x86_64                                                                                                                                                                               1/1 \n  Verifying  : kernel-ml-5.18.12-1.el7.elrepo.x86_64                                                                                                                                                                               1/1 \n\nInstalled:\n  kernel-ml.x86_64 0:5.18.12-1.el7.elrepo                                                                                                                                                                                              \n\nComplete!\n\n\n5.查看系统已安装的所有内核，并显示序号\n$ awk -F\\' '$1==\"menuentry \" &#123;print i++ \" : \" $2&#125;' /etc/grub2.cfg\n\n终端执行演示\n[root@centos ~]# awk -F\\' '$1==\"menuentry \" &#123;print i++ \" : \" $2&#125;' /etc/grub2.cfg\n0 : CentOS Linux (5.18.12-1.el7.elrepo.x86_64) 7 (Core)\n1 : CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core)\n2 : CentOS Linux (0-rescue-73bdfa889ca64635afe9a6bad8299064) 7 (Core)\n\n\n6.设置新版本内核为默认启动并重启，后面的数字就是上一步操作显示的序号\n$ grub2-set-default 0\n\n终端执行演示\n[root@centos ~]# grub2-set-default 0\n\n\n7.生成配置文件并重启\n$ grub2-mkconfig -o /boot/grub2/grub.cfg\n$ reboot\n\n终端执行演示\n[root@centos ~]# grub2-mkconfig -o /boot/grub2/grub.cfg\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.18.12-1.el7.elrepo.x86_64\nFound initrd image: /boot/initramfs-5.18.12-1.el7.elrepo.x86_64.img\nFound linux image: /boot/vmlinuz-3.10.0-1160.el7.x86_64\nFound initrd image: /boot/initramfs-3.10.0-1160.el7.x86_64.img\nFound linux image: /boot/vmlinuz-0-rescue-73bdfa889ca64635afe9a6bad8299064\nFound initrd image: /boot/initramfs-0-rescue-73bdfa889ca64635afe9a6bad8299064.img\ndone\n[root@centos ~]# reboot\n\n\n8.过几分钟连上服务器，验证一下是否更换内核成功\n$ uname -a\n\n终端执行演示\n[root@centos ~]# uname -a\nLinux centos 5.18.12-1.el7.elrepo.x86_64 #1 SMP PREEMPT_DYNAMIC Fri Jul 15 07:03:42 EDT 2022 x86_64 x86_64 x86_64 GNU/Linux\n\n\n二、启用Google BBR1.修改&#x2F;etc&#x2F;sysctl.conf文件\n$ echo \"tcp_bbr\" >> /etc/modules-load.d/modules.conf\n$ echo \"net.core.default_qdisc=fq\" >> /etc/sysctl.conf\n$ echo \"net.ipv4.tcp_congestion_control=bbr\" >> /etc/sysctl.conf\n$ sysctl -p\n\n终端执行演示\n[root@centos ~]# echo \"tcp_bbr\" >> /etc/modules-load.d/modules.conf\n[root@centos ~]# echo \"net.core.default_qdisc=fq\" >> /etc/sysctl.conf\n[root@centos ~]# echo \"net.ipv4.tcp_congestion_control=bbr\" >> /etc/sysctl.conf\n[root@centos ~]# sysctl -p\nnet.core.default_qdisc = fq\nnet.ipv4.tcp_congestion_control = bbr\n\n\n2.验证BBR是否开启\n$ sysctl net.ipv4.tcp_available_congestion_control\n$ lsmod | grep bbr\n\n终端执行演示\n[root@centos ~]# sysctl net.ipv4.tcp_available_congestion_control\nnet.ipv4.tcp_available_congestion_control = reno cubic bbr\n[root@centos ~]# lsmod | grep bbr\ntcp_bbr                20480  1 \n\n\n注意 \n\nGoogle BBR只支持使用syctemctl命令的系统，所以CentOS只支持7以上版本。\nCentOS系统默认的内核版本较低，所以需要先更新系统内核。\n升级完后可以删除旧的系统内核，参考以下(以实际内核名称为准)：\n\n$ rpm -ev kernel-devel-3.10.0-1160.el7.x86_64\n$ rpm -ev kernel-3.10.0-1160.el7.x86_64\n\n\n\n\n\n\n\n\n\n\n如果已经完成以上步骤，恭喜您的CentOS系统已经开启Google BBR算法\n在Debian上开启Google BBR一、升级系统内核注意事项\n\n这一节纯属个人习惯，完全可略过。\nDebian11的系统内核版本大于4.9，所以可以不用更新内核。但是听说越新的内核越高效，自行斟酌～\n在Debian系统上的操作默认使用root用户。\n\n1.首先检查系统更新\n$ apt update &amp;&amp; apt full-upgrade -y\n\n终端执行演示\nroot@debian:~# apt update &amp;&amp; apt full-upgrade -y\nGet:1 http://mirrors.tencentyun.com/debian bullseye InRelease [116 kB]\nGet:2 http://mirrors.tencentyun.com/debian bullseye-updates InRelease [39.4 kB]\nGet:3 http://mirrors.tencentyun.com/debian-security bullseye-security InRelease [44.1 kB]\nGet:4 http://mirrors.tencentyun.com/debian bullseye-backports InRelease [44.2 kB]\nGet:5 http://mirrors.tencentyun.com/debian bullseye-proposed-updates InRelease [44.6 kB]\nGet:6 http://mirrors.tencentyun.com/debian bullseye/main amd64 Packages [8,182 kB]\nGet:7 http://mirrors.tencentyun.com/debian bullseye/main Translation-en [6,243 kB]\nGet:8 http://mirrors.tencentyun.com/debian bullseye/contrib amd64 Packages [50.6 kB]\nGet:9 http://mirrors.tencentyun.com/debian bullseye/contrib Translation-en [46.9 kB]\n...省略\nSetting up gpg-wks-server (2.2.27-2+deb11u2) ...\nSetting up linux-headers-5.10.0-16-amd64 (5.10.127-1) ...\nSetting up gpg-wks-client (2.2.27-2+deb11u2) ...\nSetting up linux-headers-amd64 (5.10.127-1) ...\nSetting up gnupg (2.2.27-2+deb11u2) ...\nProcessing triggers for man-db (2.9.4-2) ...\nProcessing triggers for libc-bin (2.31-13+deb11u3) ...\n\n\n2.安装默认版本的内核，安装之前请先确认当前的内核版本\n$ apt install -t $(lsb_release -sc)-backports linux-image-$(dpkg --print-architecture) linux-headers-$(dpkg --print-architecture) --install-recommends -y\n\n终端执行演示\nroot@VM-8-5-debian:~# apt install -t $(lsb_release -sc)-backports linux-image-$(dpkg --print-architecture) linux-headers-$(dpkg --print-architecture) --install-recommends -y\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following packages were automatically installed and are no longer required:\n  cloud-guest-utils cloud-image-utils cloud-utils distro-info gdisk genisoimage liburing1 qemu-utils\nUse 'apt autoremove' to remove them.\nThe following additional packages will be installed:\n  linux-headers-5.18.0-0.bpo.1-amd64 linux-headers-5.18.0-0.bpo.1-common linux-image-5.18.0-0.bpo.1-amd64 linux-kbuild-5.18\nSuggested packages:\n  linux-doc-5.18 debian-kernel-handbook\nThe following NEW packages will be installed:\n  linux-headers-5.18.0-0.bpo.1-amd64 linux-headers-5.18.0-0.bpo.1-common linux-image-5.18.0-0.bpo.1-amd64 linux-kbuild-5.18\nThe following packages will be upgraded:\n  linux-headers-amd64 linux-image-amd64\n2 upgraded, 4 newly installed, 0 to remove and 36 not upgraded.\nNeed to get 80.6 MB of archives.\n...省略\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.18.0-0.bpo.1-amd64\nFound initrd image: /boot/initrd.img-5.18.0-0.bpo.1-amd64\nFound linux image: /boot/vmlinuz-5.10.0-16-amd64\nFound initrd image: /boot/initrd.img-5.10.0-16-amd64\nFound linux image: /boot/vmlinuz-5.10.0-12-amd64\nFound initrd image: /boot/initrd.img-5.10.0-12-amd64\ndone\nSetting up linux-headers-amd64 (5.18.2-1~bpo11+1) ...\nSetting up linux-image-amd64 (5.18.2-1~bpo11+1) ...\n\n\n3.更新内核启动顺序\n$ update-grub\n\n终端执行演示\nroot@debian:~# update-grub\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.18.0-0.bpo.1-amd64\nFound initrd image: /boot/initrd.img-5.18.0-0.bpo.1-amd64\nFound linux image: /boot/vmlinuz-5.10.0-16-amd64\nFound initrd image: /boot/initrd.img-5.10.0-16-amd64\nFound linux image: /boot/vmlinuz-5.10.0-12-amd64\nFound initrd image: /boot/initrd.img-5.10.0-12-amd64\ndone\n\n\n二、启用Google BBR1.修改&#x2F;etc&#x2F;sysctl.conf文件\n$ echo \"net.core.default_qdisc=fq\" >> /etc/sysctl.conf\n$ echo \"net.ipv4.tcp_congestion_control=bbr\" >> /etc/sysctl.conf\n$ sysctl -p\n\n终端执行演示\nroot@debian:~# echo \"net.core.default_qdisc=fq\" >> /etc/sysctl.conf\nroot@debian:~# echo \"net.ipv4.tcp_congestion_control=bbr\" >> /etc/sysctl.conf\nroot@debian:~# sysctl -p\nkernel.core_uses_pid = 1\nnet.ipv4.ip_forward = 0\nnet.ipv6.conf.all.forwarding = 0\nnet.ipv4.conf.default.rp_filter = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nnet.ipv4.conf.default.accept_source_route = 0\nnet.ipv4.tcp_syncookies = 1\nnet.ipv6.conf.all.disable_ipv6 = 0\nnet.ipv6.conf.default.disable_ipv6 = 0\nnet.ipv6.conf.lo.disable_ipv6 = 0\nnet.ipv4.conf.all.promote_secondaries = 1\nnet.ipv4.conf.default.promote_secondaries = 1\nnet.ipv6.neigh.default.gc_thresh3 = 4096\nnet.ipv4.neigh.default.gc_thresh3 = 4096\nkernel.printk = 5 4 1 7\nkernel.softlockup_panic = 1\nkernel.sysrq = 1\nnet.core.default_qdisc = fq\nnet.ipv4.tcp_congestion_control = bbr\n\n\n2.验证BBR是否开启\n$ sysctl net.ipv4.tcp_available_congestion_control\n$ lsmod | grep bbr\n$ reboot\n\n终端执行演示\nroot@debian:~# sysctl net.ipv4.tcp_available_congestion_control\nnet.ipv4.tcp_available_congestion_control = reno cubic bbr\nroot@debian:~# lsmod | grep bbr\ntcp_bbr                20480  1\nroot@debian:~# reboot\n\n\n\n\n\n\n\n\n\n\n\n如果已经完成以上步骤，恭喜您的Debian系统已经开启Google BBR算法\n\n\n\n\n\n\n\n提示\n本文章采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可。\n\n","slug":"在Linux系统上开启BBR加速","date":"2022-07-17T06:46:34.000Z","categories_index":"System","tags_index":"CentOS,Debian,Linux","author_index":"Riansy"}]